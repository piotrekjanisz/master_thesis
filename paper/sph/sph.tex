
% this file is called up by thesis.tex
% content in this file will be fed into the main document

%: ----------------------- introduction file header -----------------------
\chapter{SPH}


\graphicspath{{sph/figures/}}

This chapter will provide brief introduction to modeling method used in my project - Smoothed Particle Hydrodynamics (SPH).

\section{Introduction}
To perform numerical simulation of natural phenomena several steps have to be performed (see \cite[section 1.1.2]{Liu}). First the mathematical model has to be obtained from observation of physical phenomena. The mathematical model consists of a set of governing equations, boundary conditions and initial conditions. Next governing equations have to be discretized in order to solve them with a numerical algorithm.
For describing physical governing equations two basic techniques exists: Eulerian description and Lagrarian description.

For describing governing equations of fluid flows two basic techniques exists: Lagrarian and Eulerian. In the first one we look at the fluid as a set of parcels which moves though space and time. Each fluid parcel has it's own mass which is fixed, and is identified by it's position $x_0$ at time $t = 0$. We also assume that we can obtain a function of fluid parcels position $x = x(t, x_0)$. This is demonstrated on figure~\ref{eulerian_lagrarian}.
Eulerian description assumes that we observe fluid that moves through fixed spatial points. Thus we are given velocity field $v$ at every spatial point $x$ and time $t$ - $v = v(x, t)$ (figure~\cite{eulerian_lagrarian}). 
More on fluid field description can be found in \cite[section 2.1]{Hauke2008} and \cite{Price06}

\figuremacro{eulerian_lagrarian}{Different fluid observation techniques}{on the left we can see Eulerian velocity field, on the right Lagrarian pathlines.}

For discretization there are several approaches: grid based (lagrarian grid and eulerian grid) and meshfree methods (SPH, particle in cell).
Lagrarian grid is attached to material and moves with it. Each mesh cell represents one fluid parcel from Lagrarian description. The advantages of this method are simpler equations given by lagrarian description, less memory usage (as the mesh is specified only where fluid or other material is present), easiness of tracking movement of fluid parcels. However this method does not handle large material deformations over time (like for instance water splashes) well. In such cases mesh must be recomputed and it an expensive procedure.
Eulerian grid, on the other hand, is fixed in space, and covers entire domain in which fluid can move. In each grid node we calculate mass momentum and energy flux. This method handles large deformations of material easily but its computional complexity is large, especially in three dimensions. The amount of memory require is also large as whole domain must be covered with grid. 
Third way of discretization are mesh free method. The idea of them is to combine strong points of both eulerian and lagrarian grids, but without using a grid or a mesh. This is done usually by discretizing material as a set of particles. At each particle values of functions, derivatives and integrals are approximated with particle approximations. An example of mesh free method is SPH which will be further described in this chapter. 
Lagrarian and Eulerian grids as well as meshfree methods are described in more details in \cite[chapter 1]{Liu}

\section{Fundamentals of SPH}

The main idea of SPH is to replace given field A with it's integral interpolant (or kernel interpolant):
\begin{equation}
\label{eq:sph_kernel_interpolant}
A_I(r) = \int A(r')W(r - r', h)dr'
\end{equation}

Where W is a smoothing kernel and has following properties:

\begin{equation}
\label{eq:sph_kernel_property_1}
\int W(r - r', h)dr' = 1
\end{equation}

\begin{equation}
\label{eq:sph_kernel_property_2}
\lim_{h \to 0}W(r - r', h) = \delta(r-r')
\end{equation}

\begin{equation}
\label{eq:compact_condition}
(\exists \kappa \in \mathbb{R}_+ )(W(r-r', h) = 0~when~|r-r'| > \kappa h)
\end{equation}

Integral interpolant \ref{eq:sph_kernel_interpolant} can be further approximated by sumation interpolant:

\begin{equation}
\label{eq:sumation_interpolant}
A_s(r) = \sum_{b}m_b\frac{A_b}{\rho_b}W(r-r_b,h)
\end{equation}

where $\frac{m_b}{\rho_b}$ is a volume of particle $b$. What SPH does is it divides space into set of particles, each particle has it's own mass and density. Mass is fixed and density can change thus changing particle's volume. When we want to compute value of A in some point in space $r$ we compute weighted average of A at neighboring particles. Weight depends on distance of particle's center form $r$ and on particles volume. 
It's also worth noting that \ref{eq:compact_condition} defines finite domain in which smoothing kernel is non-zero. This allows to speed up computations by summing over particles in nearest neighborhood.

Replacing field $A$ with it's kernel interpolation $A_I$ yields error of $h^2$ (see~\cite[section 2.2.1]{Liu}). On the other hand accuracy of sumation interpolant \ref{eq:sumation_interpolant} is hard to predict (see~\cite[section 12.1]{Monaghan1992}).

In many physical simulations we need to compute gradient of some field A. It turns out that using integral interpolant \ref{eq:sph_kernel_interpolant} we only need to compute gradient of smoothing kernel $W$ (\cite[section 2.2.2]{Liu}):

\begin{equation}
\label{eq:integral_interpolant_gradient}
\triangledown A_I(r) = \int A(r') \triangledown W(r - r', h)dr'
\end{equation}

As earlier we can aproximate integral with sumation:

\begin{equation}
\label{eq:sumation_interpolant_gradient}
\triangledown A_s(r) = \sum_{b}m_b\frac{A_b}{\rho_b}\triangledown W(r-r_b,h) 
\end{equation}
This simplifies computations as $W$ is known and it's gradient can be given analitically. 

SPH gives a flexibility in choosing smoothing kernel. Generally Gaussian-like smoothing kernel are used, however any function W satisfying \ref{eq:sph_kernel_property_1}, \ref{eq:sph_kernel_property_2} and \ref{eq:compact_condition} can be used. It is even possible to utilize variable width kernels (TODO reference) which can be useful in case of large fluctuations in particles distributions. \cite[chapter 3]{Liu} is entirely devoted to smoothing kernels. 

SPH is a interpolation method - does not uses a grid (MESHFREE), approximates fluid or other materials as a set of particles. Requires less resources comparing to grid methods when it comes to such phenomenas as splasches or breaking waves. 

SPH first used by Leon Lucy and R. A. Gingold and J. J. Monaghan

Different kernels can be used for different computations.


paper on astrophysics from 1992 (Monaghan1992) - \cite{Monaghan1992}

book about sph (Liu) - \cite{Liu}

Particle based simulations for interactive applications (Muller2003) - \cite{Muller2003}

\section{SPH for fluids}
Fluid motion can be described by two equations. First one is conservation of mass:
\begin{equation}
\label{eq:mass_conservation}
\frac{DM}{Dt} = 0
\end{equation}
second one is Navier-Stokes conservation of momentum equation:
\begin{equation}
\label{eq:momentum_conservation}
\rho \frac{Dv}{Dt} = -\triangledown p + \mu \triangledown^2v + f
\end{equation}

Both equations are presented in Lagrarian form. $\frac{D}{Dt}$ is a material derivative (TODO opisaÄ‡ co to jest, referencja).  $p$ is the pressure, $\mu$ is fluid viscosity and f represents external forces acting on the fluid. 

Navier-Stokes equations: 
 - continuity, 
 - momentum conservation, 
 - energy conservation
For SPH first one is not necessary and for fluid simulation in games energy conservation equation can be discarded as we only interested in fluid movement, not temperature (we can assume the temperature is constant). 

TODO SPH equations needs to be symmetrized.

